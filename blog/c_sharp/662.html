<!doctype html><html lang="ru-RU" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Преобразовать строку в делегат в C#" /><meta name="author" content="Deynega Vasiliy" /><meta property="og:locale" content="ru_RU" /><meta name="description" content="Столкнулся с интересной задачей. У меня есть текст функции, записанный в строку. Я хочу получить из нее делегат и исполнять его, как обычную функцию. Раньше я к этой задаче относится как к чисто теоретической, однако недавно мне понадобилось исполнить строковое выражение и я вспомнил о компиляции кода в реальном времени. Ну согласитесь, не парсить же текст, не разбивать его на токины и не исполнять же его в ручную? Именно так бы я и сделал когда-то в школе, но сейчас хочется чтобы всю работу делал C#. Зря что ли в него добавляли все эти возможности. Я не буду рассказывать то как я думал, чтобы дойти до результата, а сразу его представлю. Итак, использование моего класса выглядит следующим образом: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // объявляем требуемый делегат. Он может иметь любые принимаемые параметры и возвращаемое значение public delegate Single TestDelegate( Single param1, Single param2 ); // строка, в которой записан текст функции. В примере это будет очень простой код. В реальности он может быть любым. String funcText = &quot;public static Single FuncName( Single param1, Single param2 )&quot; + &quot;{&quot;+ &quot; return param1 + param2;&quot;+ &quot;}&quot;; // Создаем функцию, передавая имя создаваемой функции и строку ее содержащую. // Кроме того, параметром шаблона передается тип делегата, объявленный ранее TestDelegate func = DelegateGenerator.CreateDelegate&lt; TestDelegate &gt;( &quot;FuncName&quot;, funcText ); // проверяем, получилось ли создать делегат if ( null == func ) return; // работаем как с обычной функцией Single ss = func( 5, 10 ); // ss = 15 Если вам интересно, как же все это работает, то читайте дальше!" /><meta property="og:description" content="Столкнулся с интересной задачей. У меня есть текст функции, записанный в строку. Я хочу получить из нее делегат и исполнять его, как обычную функцию. Раньше я к этой задаче относится как к чисто теоретической, однако недавно мне понадобилось исполнить строковое выражение и я вспомнил о компиляции кода в реальном времени. Ну согласитесь, не парсить же текст, не разбивать его на токины и не исполнять же его в ручную? Именно так бы я и сделал когда-то в школе, но сейчас хочется чтобы всю работу делал C#. Зря что ли в него добавляли все эти возможности. Я не буду рассказывать то как я думал, чтобы дойти до результата, а сразу его представлю. Итак, использование моего класса выглядит следующим образом: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // объявляем требуемый делегат. Он может иметь любые принимаемые параметры и возвращаемое значение public delegate Single TestDelegate( Single param1, Single param2 ); // строка, в которой записан текст функции. В примере это будет очень простой код. В реальности он может быть любым. String funcText = &quot;public static Single FuncName( Single param1, Single param2 )&quot; + &quot;{&quot;+ &quot; return param1 + param2;&quot;+ &quot;}&quot;; // Создаем функцию, передавая имя создаваемой функции и строку ее содержащую. // Кроме того, параметром шаблона передается тип делегата, объявленный ранее TestDelegate func = DelegateGenerator.CreateDelegate&lt; TestDelegate &gt;( &quot;FuncName&quot;, funcText ); // проверяем, получилось ли создать делегат if ( null == func ) return; // работаем как с обычной функцией Single ss = func( 5, 10 ); // ss = 15 Если вам интересно, как же все это работает, то читайте дальше!" /><link rel="canonical" href="http://itw66.ru/blog/c_sharp/662.html" /><meta property="og:url" content="http://itw66.ru/blog/c_sharp/662.html" /><meta property="og:site_name" content="It Works!" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2012-10-08T00:00:00+06:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Преобразовать строку в делегат в C#" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Deynega Vasiliy","url":"http://illi-studio.ru"},"dateModified":"2023-07-09T22:01:02+05:00","datePublished":"2012-10-08T00:00:00+06:00","description":"Столкнулся с интересной задачей. У меня есть текст функции, записанный в строку. Я хочу получить из нее делегат и исполнять его, как обычную функцию. Раньше я к этой задаче относится как к чисто теоретической, однако недавно мне понадобилось исполнить строковое выражение и я вспомнил о компиляции кода в реальном времени. Ну согласитесь, не парсить же текст, не разбивать его на токины и не исполнять же его в ручную? Именно так бы я и сделал когда-то в школе, но сейчас хочется чтобы всю работу делал C#. Зря что ли в него добавляли все эти возможности. Я не буду рассказывать то как я думал, чтобы дойти до результата, а сразу его представлю. Итак, использование моего класса выглядит следующим образом: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // объявляем требуемый делегат. Он может иметь любые принимаемые параметры и возвращаемое значение public delegate Single TestDelegate( Single param1, Single param2 ); // строка, в которой записан текст функции. В примере это будет очень простой код. В реальности он может быть любым. String funcText = &quot;public static Single FuncName( Single param1, Single param2 )&quot; + &quot;{&quot;+ &quot; return param1 + param2;&quot;+ &quot;}&quot;; // Создаем функцию, передавая имя создаваемой функции и строку ее содержащую. // Кроме того, параметром шаблона передается тип делегата, объявленный ранее TestDelegate func = DelegateGenerator.CreateDelegate&lt; TestDelegate &gt;( &quot;FuncName&quot;, funcText ); // проверяем, получилось ли создать делегат if ( null == func ) return; // работаем как с обычной функцией Single ss = func( 5, 10 ); // ss = 15 Если вам интересно, как же все это работает, то читайте дальше!","headline":"Преобразовать строку в делегат в C#","mainEntityOfPage":{"@type":"WebPage","@id":"http://itw66.ru/blog/c_sharp/662.html"},"url":"http://itw66.ru/blog/c_sharp/662.html"}</script><title>Преобразовать строку в делегат в C# | It Works!</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="It Works!"><meta name="application-name" content="It Works!"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"> <img src="/assets/img/logo.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"> </a><div class="site-title"> <a href="/">It Works!</a></div><div class="site-subtitle fst-italic">Научно-популярный портал о технологиях настоящего и будущего!</div></div><ul class="nav flex-column flex-grow-1 w-100 ps-0"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>ДОМАШНЯЯ СТРАНИЦА</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>КАТЕГОРИИ</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>ТЕГИ</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>АРХИВ</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>О САЙТЕ</span> </a></ul><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/mrdekk/itw66.ru" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container px-xxl-5"><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100" > <span id="breadcrumb"> <span> <a href="/"> Домашняя страница </a> </span> <span>Преобразовать строку в делегат в C# </span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Публикация</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Поиск..." > </span> <span id="search-cancel">Отменить</span></div></div><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pe-xl-4"><div class="post px-1 px-md-2"><h1 data-toc-skip>Преобразовать строку в делегат в C#</h1><div class="post-meta text-muted"> <span> Время публикации <em class="" data-ts="1349632800" data-df="DD/MM/YYYY" data-bs-toggle="tooltip" data-bs-placement="bottom" > 08/10/2012 </em> </span> <span> Обновлено <em class="" data-ts="1688922062" data-df="DD/MM/YYYY" data-bs-toggle="tooltip" data-bs-placement="bottom" > 09/07/2023 </em> </span><div class="d-flex justify-content-between"> <span> Автор <em> <a href="http://illi-studio.ru">Deynega Vasiliy</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1458 слов" > <em>8 минут</em> чтения</span></div></div></div><div class="post-content"><p>Столкнулся с интересной задачей. У меня есть текст функции, записанный в строку. Я хочу получить из нее делегат и исполнять его, как обычную функцию. Раньше я к этой задаче относится как к чисто теоретической, однако недавно мне понадобилось исполнить строковое выражение и я вспомнил о компиляции кода в реальном времени.</p><p>Ну согласитесь, не парсить же текст, не разбивать его на токины и не исполнять же его в ручную? Именно так бы я и сделал когда-то в школе, но сейчас хочется чтобы всю работу делал C#. Зря что ли в него добавляли все эти возможности.</p><p>Я не буду рассказывать то как я думал, чтобы дойти до результата, а сразу его представлю. Итак, использование моего класса выглядит следующим образом:</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Скопировано успешно!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="c1">// объявляем требуемый делегат. Он может иметь любые принимаемые параметры и возвращаемое значение</span>
<span class="k">public</span> <span class="k">delegate</span> <span class="n">Single</span>    <span class="nf">TestDelegate</span><span class="p">(</span> <span class="n">Single</span> <span class="n">param1</span><span class="p">,</span> <span class="n">Single</span> <span class="n">param2</span> <span class="p">);</span>

<span class="c1">// строка, в которой записан текст функции. В примере это будет очень простой код. В реальности он может быть любым.</span>
<span class="n">String</span> <span class="n">funcText</span> <span class="p">=</span> <span class="s">"public static Single    FuncName( Single param1, Single param2 )"</span> <span class="p">+</span>
        <span class="s">"{"</span><span class="p">+</span>
        <span class="s">"    return param1 + param2;"</span><span class="p">+</span>
        <span class="s">"}"</span><span class="p">;</span>

<span class="c1">// Создаем функцию, передавая имя создаваемой функции и строку ее содержащую.</span>
<span class="c1">// Кроме того, параметром шаблона передается тип делегата, объявленный ранее</span>
<span class="n">TestDelegate</span> <span class="n">func</span> <span class="p">=</span> <span class="n">DelegateGenerator</span><span class="p">.</span><span class="n">CreateDelegate</span><span class="p">&lt;</span> <span class="n">TestDelegate</span> <span class="p">&gt;(</span> <span class="s">"FuncName"</span><span class="p">,</span> <span class="n">funcText</span> <span class="p">);</span>

<span class="c1">// проверяем, получилось ли создать делегат</span>
<span class="k">if</span> <span class="p">(</span> <span class="k">null</span> <span class="p">==</span> <span class="n">func</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">;</span>

<span class="c1">// работаем как с обычной функцией</span>
<span class="n">Single</span> <span class="n">ss</span> <span class="p">=</span> <span class="nf">func</span><span class="p">(</span> <span class="m">5</span><span class="p">,</span> <span class="m">10</span> <span class="p">);</span> <span class="c1">// ss = 15</span>
</pre></table></code></div></div><p>Если вам интересно, как же все это работает, то читайте дальше!</p><p><strong>Проверяем на ошибки</strong></p><p>На самом деле всю работу делает класс <em>DelegateGenerator</em>, который я создал. Он имеет две публичные функции и одну внутреннюю структуру. Функции создания делегата отличаются только возвращаемым значением. Первая функция возвращает сам делегат, а вторая возвращает класс с подробной информацией о созданной функции.</p><p>Класс <em>DelegateInfo&lt; T &gt;</em> нужен просто для сохранения всей информации о функции и ошибках, которые возникли при ее компиляции.</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Скопировано успешно!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="n">DelegateInfo</span><span class="p">&lt;</span> <span class="n">T</span> <span class="p">&gt;</span> <span class="n">funcInfo</span> <span class="p">=</span> <span class="n">DelegateGenerator</span><span class="p">.</span><span class="n">CreateDelegateInfo</span><span class="p">&lt;</span> <span class="n">TestDelegate</span> <span class="p">&gt;(</span> <span class="s">"FuncName"</span><span class="p">,</span> <span class="n">funcText</span> <span class="p">);</span>
<span class="k">if</span><span class="p">(</span> <span class="n">funcInfo</span><span class="p">.</span><span class="n">WasError</span> <span class="p">)</span>
    <span class="p">...;</span> <span class="c1">// funcInfo.ErrorText будет содержать текст ошибки компиляции</span>

<span class="c1">// исполняем функцию</span>
<span class="n">Single</span> <span class="n">ss</span> <span class="p">=</span> <span class="n">funcInfo</span><span class="p">.</span><span class="nf">Exec</span><span class="p">(</span> <span class="m">5</span><span class="p">,</span> <span class="m">10</span> <span class="p">);</span> <span class="c1">// ss = 15</span>
</pre></table></code></div></div><p><strong>Детали реализации</strong></p><p>Процесс компиляции функции достаточно прост. Первоначально создается текст класса, куда добавляется наша функция как единственная.</p><p>Обратите внимание, что функция, которая будет создаваться должна быть объявлена как <strong>public static</strong>. Это необходимо, чтобы можно было корректно исполнять эту функцию из любого кода. Помним, что свободных функций в C# не существует.</p><p>После того, как получен текст нового класса его нужно скомпилировать. При компиляции указываются все библиотеки, от которых будет зависеть создаваемая функция (переменная <em>referenceAssemblies</em>).</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Скопировано успешно!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="n">String</span><span class="p">[]</span> <span class="n">referenceAssemblies</span> <span class="p">=</span> 
<span class="p">{</span> 
    <span class="s">"System.dll"</span><span class="p">,</span>
    <span class="s">"System.Data.dll"</span><span class="p">,</span>
    <span class="s">"System.Design.dll"</span><span class="p">,</span>
    <span class="s">"System.Drawing.dll"</span><span class="p">,</span>
    <span class="s">"System.Windows.Forms.dll"</span><span class="p">,</span>
    <span class="s">"System.Xml.dll"</span>
<span class="p">};</span>
</pre></table></code></div></div><p>Если ваша функция будет зависеть от каких-то библиотек, то расширьте их список. Если у вас слишком большое разнообразие подключаемых библиотек или вы не можете их знать заранее, то передавайте его при создании функции, как еще один параметр.</p><p>После компиляции класса проверяем, были ли ошибки компиляции. Если они были, то формируем строку с ними и выходим. Если все прошло успешно, то получаем функцию у скомпилированного класса и возвращаем ее как требуемый делегат.</p><p><strong>Полный код класса</strong></p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Скопировано успешно!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Reflection</span><span class="p">;</span>

<span class="k">using</span> <span class="nn">Microsoft.CSharp</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.CodeDom.Compiler</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">DelegateGenerator</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">DelegateGenerator</span>
    <span class="p">{</span>
        <span class="err">#</span><span class="n">region</span> <span class="k">static</span> <span class="n">variables</span>
        <span class="c1">// статическая переменная для создания уникальных имен</span>
        <span class="k">private</span> <span class="k">static</span> <span class="n">Int32</span>            <span class="n">m_classIndex</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="err">#</span><span class="n">endregion</span>


        <span class="err">#</span><span class="n">region</span> <span class="k">internal</span> <span class="n">types</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// класс, который содержит всю информацию о делегате</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">public</span> <span class="k">class</span> <span class="nc">DelegateInfo</span><span class="p">&lt;</span> <span class="n">T</span> <span class="p">&gt;</span>
        <span class="p">{</span>
            <span class="c1">// исходный код функции</span>
            <span class="k">public</span> <span class="n">String</span>            <span class="n">Code</span><span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
            <span class="c1">// информация о созданной функции</span>
            <span class="k">public</span> <span class="n">MethodInfo</span>        <span class="n">MethodInfo</span><span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
            <span class="c1">// скомпелированный делегат</span>
            <span class="k">public</span> <span class="n">Delegate</span>            <span class="n">Delegate</span><span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">public</span> <span class="n">T</span>            <span class="n">Exec</span><span class="p">{</span> <span class="k">get</span><span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="n">Convert</span><span class="p">.</span><span class="nf">ChangeType</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="n">Delegate</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="p">);</span> <span class="p">}</span> <span class="p">}</span>
            <span class="c1">// текст ошибки</span>
            <span class="k">public</span> <span class="n">String</span>            <span class="n">ErrorText</span><span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
            <span class="c1">// была ли ошибка компиляции</span>
            <span class="k">public</span> <span class="kt">bool</span>            <span class="n">WasError</span><span class="p">{</span> <span class="k">get</span><span class="p">{</span> <span class="k">return</span> <span class="p">!</span><span class="n">String</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="n">ErrorText</span> <span class="p">);</span> <span class="p">}</span> <span class="p">}</span>
        <span class="p">}</span>
        <span class="err">#</span><span class="n">endregion</span>


        <span class="err">#</span><span class="n">region</span> <span class="n">management</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// Создаем делегат по коду</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="c1">/// &lt;typeparam name="T"&gt;тип делегата&lt;/typeparam&gt;</span>
        <span class="c1">/// &lt;param name="name"&gt;Имя создаваемой функции. Должно быть таким же, как в тексте функции&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="code"&gt;Текст функции&lt;/param&gt;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">T</span>        <span class="n">CreateDelegate</span><span class="p">&lt;</span> <span class="n">T</span> <span class="p">&gt;(</span> <span class="n">String</span> <span class="n">funcName</span><span class="p">,</span> <span class="n">String</span> <span class="n">code</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// заполняем информацию о функции</span>
            <span class="n">DelegateInfo</span><span class="p">&lt;</span> <span class="n">T</span> <span class="p">&gt;</span> <span class="n">del</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DelegateInfo</span><span class="p">&lt;</span> <span class="n">T</span> <span class="p">&gt;();</span>
            <span class="n">del</span><span class="p">.</span><span class="n">Code</span>        <span class="p">=</span> <span class="n">code</span><span class="p">;</span>
            <span class="n">del</span><span class="p">.</span><span class="n">MethodInfo</span>    <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
            <span class="n">del</span><span class="p">.</span><span class="n">Delegate</span>    <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
            <span class="n">del</span><span class="p">.</span><span class="n">ErrorText</span>    <span class="p">=</span> <span class="n">String</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>

            <span class="c1">// компилируем функцию</span>
            <span class="n">CompileDelegate</span><span class="p">&lt;</span> <span class="n">T</span> <span class="p">&gt;(</span> <span class="n">funcName</span><span class="p">,</span> <span class="n">del</span> <span class="p">);</span>
            <span class="k">if</span><span class="p">(</span> <span class="p">!</span><span class="n">del</span><span class="p">.</span><span class="n">WasError</span> <span class="p">)</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="n">Convert</span><span class="p">.</span><span class="nf">ChangeType</span><span class="p">(</span> <span class="n">del</span><span class="p">.</span><span class="n">Delegate</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="p">);</span>
            <span class="k">return</span> <span class="k">default</span><span class="p">(</span> <span class="n">T</span> <span class="p">);</span>
        <span class="p">}</span>


        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// Создаем делегат по коду и возвращаем структуру с информацией о нем</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="c1">/// &lt;typeparam name="T"&gt;тип делегата&lt;/typeparam&gt;</span>
        <span class="c1">/// &lt;param name="name"&gt;Имя создаваемой функции. Должно быть таким же, как в тексте функции&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="code"&gt;Текст функции&lt;/param&gt;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">DelegateInfo</span><span class="p">&lt;</span> <span class="n">T</span> <span class="p">&gt;</span>    <span class="n">CreateDelegateInfo</span><span class="p">&lt;</span> <span class="n">T</span> <span class="p">&gt;(</span> <span class="n">String</span> <span class="n">funcName</span><span class="p">,</span> <span class="n">String</span> <span class="n">code</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// заполняем информацию о функции</span>
            <span class="n">DelegateInfo</span><span class="p">&lt;</span> <span class="n">T</span> <span class="p">&gt;</span> <span class="n">del</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DelegateInfo</span><span class="p">&lt;</span> <span class="n">T</span> <span class="p">&gt;();</span>
            <span class="n">del</span><span class="p">.</span><span class="n">Code</span>        <span class="p">=</span> <span class="n">code</span><span class="p">;</span>
            <span class="n">del</span><span class="p">.</span><span class="n">MethodInfo</span>    <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
            <span class="n">del</span><span class="p">.</span><span class="n">Delegate</span>    <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
            <span class="n">del</span><span class="p">.</span><span class="n">ErrorText</span>    <span class="p">=</span> <span class="n">String</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>

            <span class="c1">// компилируем функцию</span>
            <span class="n">CompileDelegate</span><span class="p">&lt;</span> <span class="n">T</span> <span class="p">&gt;(</span> <span class="n">funcName</span><span class="p">,</span> <span class="n">del</span> <span class="p">);</span>
            <span class="k">return</span> <span class="n">del</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="err">#</span><span class="n">endregion</span>


        <span class="err">#</span><span class="n">region</span> <span class="n">compile</span> <span class="n">functions</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// Компилируем делегат</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">private</span> <span class="k">static</span> <span class="k">void</span>    <span class="n">CompileDelegate</span><span class="p">&lt;</span> <span class="n">T</span> <span class="p">&gt;(</span> <span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">DelegateInfo</span><span class="p">&lt;</span> <span class="n">T</span> <span class="p">&gt;</span> <span class="n">del</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// перечисляем все библиотеки, от которых может зависеть текст функции</span>
            <span class="n">String</span><span class="p">[]</span> <span class="n">referenceAssemblies</span> <span class="p">=</span> 
            <span class="p">{</span> 
                <span class="s">"System.dll"</span><span class="p">,</span>
                <span class="s">"System.Data.dll"</span><span class="p">,</span>
                <span class="s">"System.Design.dll"</span><span class="p">,</span>
                <span class="s">"System.Drawing.dll"</span><span class="p">,</span>
                <span class="s">"System.Windows.Forms.dll"</span><span class="p">,</span>
                <span class="s">"System.Xml.dll"</span>
            <span class="p">};</span>

            <span class="n">String</span> <span class="n">className</span> <span class="p">=</span> <span class="s">"C"</span> <span class="p">+</span> <span class="n">name</span> <span class="p">+</span> <span class="n">m_classIndex</span><span class="p">.</span><span class="nf">ToString</span><span class="p">();</span>
            <span class="n">m_classIndex</span><span class="p">++;</span>

            <span class="c1">// создаем полный текст класса с функцией</span>
            <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>
            <span class="n">sb</span><span class="p">.</span><span class="nf">AppendLine</span><span class="p">(</span> <span class="s">"using System;"</span> <span class="p">);</span>
            <span class="n">sb</span><span class="p">.</span><span class="nf">AppendLine</span><span class="p">(</span> <span class="s">"using System.Data;"</span> <span class="p">);</span>
            <span class="n">sb</span><span class="p">.</span><span class="nf">AppendLine</span><span class="p">(</span> <span class="s">"using System.Text;"</span> <span class="p">);</span>
            <span class="n">sb</span><span class="p">.</span><span class="nf">AppendLine</span><span class="p">(</span> <span class="s">"using System.Design;"</span> <span class="p">);</span>
            <span class="n">sb</span><span class="p">.</span><span class="nf">AppendLine</span><span class="p">(</span> <span class="s">"using System.Drawing;"</span> <span class="p">);</span>
            <span class="n">sb</span><span class="p">.</span><span class="nf">AppendLine</span><span class="p">(</span> <span class="s">"using System.Windows.Forms;"</span> <span class="p">);</span>
            <span class="n">sb</span><span class="p">.</span><span class="nf">AppendLine</span><span class="p">(</span> <span class="s">"using System.Collections.Generic;"</span> <span class="p">);</span>
            <span class="n">sb</span><span class="p">.</span><span class="nf">AppendLine</span><span class="p">(</span> <span class="s">"namespace DelegateGenerator"</span> <span class="p">);</span>
            <span class="n">sb</span><span class="p">.</span><span class="nf">AppendLine</span><span class="p">(</span> <span class="s">"{"</span> <span class="p">);</span>
            <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span> <span class="s">"    public class "</span> <span class="p">);</span> <span class="n">sb</span><span class="p">.</span><span class="nf">AppendLine</span><span class="p">(</span> <span class="n">className</span> <span class="p">);</span>
            <span class="n">sb</span><span class="p">.</span><span class="nf">AppendLine</span><span class="p">(</span> <span class="s">"    {"</span> <span class="p">);</span>
            <span class="n">sb</span><span class="p">.</span><span class="nf">AppendLine</span><span class="p">(</span> <span class="n">del</span><span class="p">.</span><span class="n">Code</span> <span class="p">);</span>
            <span class="n">sb</span><span class="p">.</span><span class="nf">AppendLine</span><span class="p">(</span> <span class="s">"    }"</span> <span class="p">);</span>
            <span class="n">sb</span><span class="p">.</span><span class="nf">AppendLine</span><span class="p">(</span> <span class="s">"}"</span> <span class="p">);</span>

            <span class="c1">// компилируем класс</span>
            <span class="n">CompilerParameters</span> <span class="n">codeParams</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CompilerParameters</span><span class="p">(</span> <span class="n">referenceAssemblies</span> <span class="p">);</span>
            <span class="n">codeParams</span><span class="p">.</span><span class="n">GenerateExecutable</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
            <span class="n">codeParams</span><span class="p">.</span><span class="n">GenerateInMemory</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="n">CSharpCodeProvider</span> <span class="n">codeProvider</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CSharpCodeProvider</span><span class="p">(</span> <span class="p">);</span>
            <span class="n">CompilerResults</span> <span class="n">codeResult</span> <span class="p">=</span> <span class="n">codeProvider</span><span class="p">.</span><span class="nf">CompileAssemblyFromSource</span><span class="p">(</span> <span class="n">codeParams</span><span class="p">,</span> <span class="n">sb</span><span class="p">.</span><span class="nf">ToString</span><span class="p">()</span> <span class="p">);</span>

            <span class="c1">// проверяем результат на ошибку</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">codeResult</span><span class="p">.</span><span class="n">Errors</span><span class="p">.</span><span class="n">HasErrors</span> <span class="p">)</span>
            <span class="p">{</span>
                <span class="n">StringBuilder</span> <span class="n">err</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>
                <span class="k">for</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">codeResult</span><span class="p">.</span><span class="n">Errors</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="p">++</span><span class="n">i</span> <span class="p">)</span>
                    <span class="n">err</span><span class="p">.</span><span class="nf">AppendLine</span><span class="p">(</span> <span class="n">codeResult</span><span class="p">.</span><span class="n">Errors</span><span class="p">[</span> <span class="n">i</span> <span class="p">].</span><span class="nf">ToString</span><span class="p">()</span> <span class="p">);</span>
                <span class="n">del</span><span class="p">.</span><span class="n">ErrorText</span> <span class="p">=</span> <span class="n">err</span><span class="p">.</span><span class="nf">ToString</span><span class="p">();</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// получаем функцию созданного класса по имени</span>
            <span class="n">Type</span> <span class="n">type</span> <span class="p">=</span> <span class="n">codeResult</span><span class="p">.</span><span class="n">CompiledAssembly</span><span class="p">.</span><span class="nf">GetType</span><span class="p">(</span> <span class="s">"DelegateGenerator."</span> <span class="p">+</span> <span class="n">className</span> <span class="p">);</span>
            <span class="n">del</span><span class="p">.</span><span class="n">MethodInfo</span> <span class="p">=</span> <span class="n">type</span><span class="p">.</span><span class="nf">GetMethod</span><span class="p">(</span> <span class="n">name</span> <span class="p">);</span>
            <span class="k">if</span><span class="p">(</span> <span class="k">null</span> <span class="p">==</span> <span class="n">del</span><span class="p">.</span><span class="n">MethodInfo</span> <span class="p">)</span>
            <span class="p">{</span>
                <span class="n">del</span><span class="p">.</span><span class="n">ErrorText</span> <span class="p">=</span> <span class="n">String</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span> <span class="s">"Delegate name '{0}' error"</span><span class="p">,</span> <span class="n">name</span> <span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">del</span><span class="p">.</span><span class="n">Delegate</span> <span class="p">=</span> <span class="n">Delegate</span><span class="p">.</span><span class="nf">CreateDelegate</span><span class="p">(</span> <span class="k">typeof</span><span class="p">(</span> <span class="n">T</span> <span class="p">),</span> <span class="n">del</span><span class="p">.</span><span class="n">MethodInfo</span> <span class="p">);</span>
                <span class="k">if</span><span class="p">(</span> <span class="k">null</span> <span class="p">==</span> <span class="n">del</span><span class="p">.</span><span class="n">Delegate</span> <span class="p">)</span>
                    <span class="n">del</span><span class="p">.</span><span class="n">ErrorText</span> <span class="p">=</span> <span class="n">String</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span> <span class="s">"Delegate type '{0}' error"</span><span class="p">,</span> <span class="n">name</span> <span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="p">}</span>
        <span class="err">#</span><span class="n">endregion</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Из текста для краткости я вырезал обработку исключений и проверки многопоточности. Они не нужны для демонстрации возможностей. И помните, что компиляция - это затратная по времени операция. У меня компиляция простой функции занимала около 0.14 секунды. Я не ставил целью данной статьи исследовать реализацию на производительность, так что если вам это интересно, то попробуйте сами.</p><h3 id="комментарии"><span class="me-2">Комментарии</span><a href="#комментарии" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p><strong>mrdekk, 9 окт. 2012, 01:54</strong> С помощью этих идей можно делать интересные вещи:</p><ul><li>Систему плагинов для приложения<li>Генератор отчетов<li>Классы-обертки для PropertyGrid<li>…</ul><p>Однако обязательно стоит помнить, что такие вещи открывают не только проблемы производительности, но и проблемы безопасности. Т.к. из этого компилируемого кода можно много чего узнать о Вашем приложении с помощью рефлексии. <br /></p><p>И еще, функции не обязательно должны быть public static — это важно для темы статьи, т.к. мы хотим получить делегат. Однако если не ставить целью получить именно делегат, можно компилировать целые классы и выполнять их на лету.</p></blockquote><blockquote><blockquote><p><strong>FiloXSee, 9 окт. 2012, 11:39</strong> Да. Еще хочу добавить задачи, которые можно решать таким методов:<br /></p><ol><li>Вычисление строковых выражений<br /><li>Создание скриптовых функций</ol></blockquote></blockquote><blockquote><p><strong>FiloXSee, 9 окт. 2012, 12:09</strong> На форумах подсказали, что есть еще реализация от Microsoft похожей задачи. Она более функциональна, но и более тяжеловесна. Кому интересно, читайте про <a href="http://msdn.microsoft.com/en-us/library/system.codedom.compiler.codedomprovider.aspx" rel="nofollow">CodeDomProvider</a>.</p></blockquote></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href='/categories/c/'>C#</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/c/" class="post-tag no-text-decoration" >c#</a> <a href="/tags/%D0%B4%D0%B5%D0%BB%D0%B5%D0%B3%D0%B0%D1%82/" class="post-tag no-text-decoration" >делегат</a> <a href="/tags/%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5/" class="post-tag no-text-decoration" >программирование</a> <a href="/tags/%D0%BA%D0%BE%D0%BC%D0%BF%D0%B8%D0%BB%D1%8F%D1%86%D0%B8%D1%8F/" class="post-tag no-text-decoration" >компиляция</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Публикация защищена лицензией <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> .</div><div class="share-wrapper"> <span class="share-label text-muted me-1">Поделиться</span> <span class="share-icons"> <a href="https://t.me/share/url?url=http%3A%2F%2Fitw66.ru%2Fblog%2Fc_sharp%2F662.html&text=%D0%9F%D1%80%D0%B5%D0%BE%D0%B1%D1%80%D0%B0%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D1%8C%20%D1%81%D1%82%D1%80%D0%BE%D0%BA%D1%83%20%D0%B2%20%D0%B4%D0%B5%D0%BB%D0%B5%D0%B3%D0%B0%D1%82%20%D0%B2%20C#%0A%20-%20It%20Works!" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram" > <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-bs-toggle="tooltip" data-bs-placement="top" title="Скопировать ссылку" data-title-succeed="Ссылка успешно скопирована!" > </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Недавно обновлено</div><ul class="post-content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/blog/china/2.html">Дух Китая. День второй </a><li class="text-truncate lh-lg"> <a href="/blog/china/4.html">Дух Китая. Пекин. Запретный город </a><li class="text-truncate lh-lg"> <a href="/blog/china/1.html">Дух Китая. Первый день, первые впечатления. </a><li class="text-truncate lh-lg"> <a href="/blog/12.html">5 инструментов работы с текстом которые вы обязаны знать </a><li class="text-truncate lh-lg"> <a href="/blog/c_plus_plus/14.html">Как избавится от vcredist'a </a></ul></div><div id="access-tags"><div class="panel-heading">Популярные теги</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/%D0%BA%D0%BE%D1%81%D0%BC%D0%BE%D1%81/">космос</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D0%B0%D0%BB%D1%8C%D1%82%D0%B5%D1%80%D0%BD%D0%B0%D1%82%D0%B8%D0%B2%D0%BD%D0%B0%D1%8F-%D1%8D%D0%BD%D0%B5%D1%80%D0%B3%D0%B8%D1%8F/">альтернативная энергия</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D1%81%D0%BE%D0%BB%D0%BD%D0%B5%D1%87%D0%BD%D0%B0%D1%8F-%D1%8D%D0%BD%D0%B5%D1%80%D0%B3%D0%B8%D1%8F/">солнечная энергия</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D1%8D%D0%BD%D0%B5%D1%80%D0%B3%D0%B8%D1%8F-%D0%B2%D0%B5%D1%82%D1%80%D0%B0/">энергия ветра</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D0%BA%D0%B8%D1%82%D0%B0%D0%B9/">китай</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D0%B0%D0%BB%D1%8C%D1%82%D0%B5%D1%80%D0%BD%D0%B0%D1%82%D0%B8%D0%B2%D0%BD%D0%B0%D1%8F-%D1%8D%D0%BD%D0%B5%D1%80%D0%B3%D0%B5%D1%82%D0%B8%D0%BA%D0%B0/">альтернативная энергетика</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D0%B2%D0%BE%D0%B4%D0%B0/">вода</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D1%8D%D0%BA%D0%BE%D0%BB%D0%BE%D0%B3%D0%B8%D1%8F/">экология</a> <a class="post-tag btn btn-outline-primary" href="/tags/c/">c++</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D0%B7%D0%B5%D0%BC%D0%BB%D1%8F/">земля</a></div></div></div><div id="toc-wrapper" class="ps-0 pe-4 mb-5"><div class="panel-heading ps-3 pt-2 mb-2">Содержание</div><nav id="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-3 pe-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ms-1" data-toc-skip> Вам также может быть интересно</h3><div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><div class="col"> <a href="/blog/c_sharp/499.html" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1309197600" data-df="DD/MM/YYYY" > 28/06/2011 </em><h4 class="pt-0 my-2" data-toc-skip>Интеграция Native кода в C# проект</h4><div class="text-muted small"><p> Сегодня стала очень популярной платформа .Net Framework и язык C#. На ней пишутся приложения, игры, инструменты. Однако существует много кода написанного на C++, который часто нужно использовать в ...</p></div></div></a></div><div class="col"> <a href="/blog/c_sharp/559.html" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1322762400" data-df="DD/MM/YYYY" > 02/12/2011 </em><h4 class="pt-0 my-2" data-toc-skip>Проблема событий при редактировании компонентов из кода в WinForms</h4><div class="text-muted small"><p> При работе с интерфейсом WinForms в C# часто появляется проблема с событиями компонентов. Проблема заключается в следующем: Если редактировать содержимое компонента из кода (например указать текущи...</p></div></div></a></div><div class="col"> <a href="/blog/c_sharp/567.html" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1324576800" data-df="DD/MM/YYYY" > 23/12/2011 </em><h4 class="pt-0 my-2" data-toc-skip>Создание системы конфигурирования приложения в C#. Паттерн "первокласный ключ".</h4><div class="text-muted small"><p> Существует множество способов сохранения данных приложения для их повторного использования при следующем старте. Какой именно вы выберите (хранение данных в базе, в файле конфигурации, в реестре и ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/blog/thoughts/636.html" class="btn btn-outline-primary" prompt="Следующая публикация" ><p>Мысли одной строкой. Умение думать</p></a> <a href="/blog/space/663.html" class="btn btn-outline-primary" prompt="Предыдущая публикация" ><p>NASA собирается использовать микробы для получения строительных материалов на Марсе!</p></a></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Популярные теги</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/%D0%BA%D0%BE%D1%81%D0%BC%D0%BE%D1%81/">космос</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D0%B0%D0%BB%D1%8C%D1%82%D0%B5%D1%80%D0%BD%D0%B0%D1%82%D0%B8%D0%B2%D0%BD%D0%B0%D1%8F-%D1%8D%D0%BD%D0%B5%D1%80%D0%B3%D0%B8%D1%8F/">альтернативная энергия</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D1%81%D0%BE%D0%BB%D0%BD%D0%B5%D1%87%D0%BD%D0%B0%D1%8F-%D1%8D%D0%BD%D0%B5%D1%80%D0%B3%D0%B8%D1%8F/">солнечная энергия</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D1%8D%D0%BD%D0%B5%D1%80%D0%B3%D0%B8%D1%8F-%D0%B2%D0%B5%D1%82%D1%80%D0%B0/">энергия ветра</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D0%BA%D0%B8%D1%82%D0%B0%D0%B9/">китай</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D0%B0%D0%BB%D1%8C%D1%82%D0%B5%D1%80%D0%BD%D0%B0%D1%82%D0%B8%D0%B2%D0%BD%D0%B0%D1%8F-%D1%8D%D0%BD%D0%B5%D1%80%D0%B3%D0%B5%D1%82%D0%B8%D0%BA%D0%B0/">альтернативная энергетика</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D0%B2%D0%BE%D0%B4%D0%B0/">вода</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D1%8D%D0%BA%D0%BE%D0%BB%D0%BE%D0%B3%D0%B8%D1%8F/">экология</a> <a class="post-tag btn btn-outline-primary" href="/tags/c/">c++</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D0%B7%D0%B5%D0%BC%D0%BB%D1%8F/">земля</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div></div><footer><div class="container px-lg-4"><div class="d-flex justify-content-center align-items-center text-muted mx-md-3"><p>Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme</p><p>© 2023 <a href=""></a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Публикации на сайте защищены лицензией Creative Commons Attribution 4.0 International (CC BY 4.0), если в тексте публикации не указано иное." >Некоторые права защищены.</span></p></div></div></footer><div id="mask"></div><button id="back-to-top" aria-label="back-to-top" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">Доступна новая версия контента.</p><button type="button" class="btn btn-primary" aria-label="Update"> Обновлять </button></div></div><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.0/dist/jquery.min.js,npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.7/dayjs.min.js,npm/dayjs@1.11.7/locale/ru.min.js,npm/dayjs@1.11.7/plugin/relativeTime.min.js,npm/dayjs@1.11.7/plugin/localizedFormat.min.js,npm/tocbot@4.21.0/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-16734363-3"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-16734363-3'); }); </script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="px-1 px-sm-2 px-lg-4 px-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="//mc.yandex.ru/metrika/watch.js" type="text/javascript"></script><div style="display:none;"><script type="text/javascript"> try { var yaCounter1534027 = new Ya.Metrika(1534027); } catch(e){} </script></div><noscript><div style="position:absolute"><img src="//mc.yandex.ru/watch/1534027" alt="" /></div></noscript>
