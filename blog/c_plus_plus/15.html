<!doctype html><html lang="ru-RU" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Тест на быстродействие: Hash Map vs Vector" /><meta name="author" content="Deynega Vasiliy" /><meta property="og:locale" content="ru_RU" /><meta name="description" content="Задача: определить контейнер, в котором оптимальнее всего хранить данные (текстуры, буферы и т.п.). Сравним наиболее подходящие варианты: сортированный массив и Hash Map. Условие: контейнер один раз заполняется, а затем с ним ведется работа. (т.е. не рассматривается вариант изменения содержимого контейнера в реальном времени) Критерий: Скорость заполнения Скорость выборки Данные: поскольку задача поиска, то в качестве данных используются целые числа. Если требуется хранить структуры, то это повлияет только на скорость заполнения массива, но не время поиска данных. Ключ всегда лучше получать как хеш по данным или уникальное поле данных в структуре." /><meta property="og:description" content="Задача: определить контейнер, в котором оптимальнее всего хранить данные (текстуры, буферы и т.п.). Сравним наиболее подходящие варианты: сортированный массив и Hash Map. Условие: контейнер один раз заполняется, а затем с ним ведется работа. (т.е. не рассматривается вариант изменения содержимого контейнера в реальном времени) Критерий: Скорость заполнения Скорость выборки Данные: поскольку задача поиска, то в качестве данных используются целые числа. Если требуется хранить структуры, то это повлияет только на скорость заполнения массива, но не время поиска данных. Ключ всегда лучше получать как хеш по данным или уникальное поле данных в структуре." /><link rel="canonical" href="http://itw66.ru/blog/c_plus_plus/15.html" /><meta property="og:url" content="http://itw66.ru/blog/c_plus_plus/15.html" /><meta property="og:site_name" content="It Works!" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2010-08-31T00:00:00+06:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Тест на быстродействие: Hash Map vs Vector" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Deynega Vasiliy","url":"http://illi-studio.ru"},"dateModified":"2023-07-10T10:22:21+05:00","datePublished":"2010-08-31T00:00:00+06:00","description":"Задача: определить контейнер, в котором оптимальнее всего хранить данные (текстуры, буферы и т.п.). Сравним наиболее подходящие варианты: сортированный массив и Hash Map. Условие: контейнер один раз заполняется, а затем с ним ведется работа. (т.е. не рассматривается вариант изменения содержимого контейнера в реальном времени) Критерий: Скорость заполнения Скорость выборки Данные: поскольку задача поиска, то в качестве данных используются целые числа. Если требуется хранить структуры, то это повлияет только на скорость заполнения массива, но не время поиска данных. Ключ всегда лучше получать как хеш по данным или уникальное поле данных в структуре.","headline":"Тест на быстродействие: Hash Map vs Vector","mainEntityOfPage":{"@type":"WebPage","@id":"http://itw66.ru/blog/c_plus_plus/15.html"},"url":"http://itw66.ru/blog/c_plus_plus/15.html"}</script><title>Тест на быстродействие: Hash Map vs Vector | It Works!</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="It Works!"><meta name="application-name" content="It Works!"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"> <img src="/assets/img/logo.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"> </a><div class="site-title"> <a href="/">It Works!</a></div><div class="site-subtitle fst-italic">Научно-популярный портал о технологиях настоящего и будущего!</div></div><ul class="nav flex-column flex-grow-1 w-100 ps-0"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>ДОМАШНЯЯ СТРАНИЦА</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>КАТЕГОРИИ</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>ТЕГИ</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>АРХИВ</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>О САЙТЕ</span> </a></ul><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/mrdekk/itw66.ru" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container px-xxl-5"><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100" > <span id="breadcrumb"> <span> <a href="/"> Домашняя страница </a> </span> <span>Тест на быстродействие: Hash Map vs Vector </span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Публикация</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Поиск..." > </span> <span id="search-cancel">Отменить</span></div></div><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pe-xl-4"><div class="post px-1 px-md-2"><h1 data-toc-skip>Тест на быстродействие: Hash Map vs Vector</h1><div class="post-meta text-muted"> <span> Время публикации <em class="" data-ts="1283191200" data-df="DD/MM/YYYY" data-bs-toggle="tooltip" data-bs-placement="bottom" > 31/08/2010 </em> </span> <span> Обновлено <em class="" data-ts="1688966541" data-df="DD/MM/YYYY" data-bs-toggle="tooltip" data-bs-placement="bottom" > 10/07/2023 </em> </span><div class="d-flex justify-content-between"> <span> Автор <em> <a href="http://illi-studio.ru">Deynega Vasiliy</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1302 слов" > <em>7 минут</em> чтения</span></div></div></div><div class="post-content"><p>Задача: определить контейнер, в котором оптимальнее всего хранить данные (текстуры, буферы и т.п.). Сравним наиболее подходящие варианты: сортированный массив и Hash Map. Условие: контейнер один раз заполняется, а затем с ним ведется работа. (т.е. не рассматривается вариант изменения содержимого контейнера в реальном времени) Критерий:</p><ol><li>Скорость заполнения<li>Скорость выборки Данные: поскольку задача поиска, то в качестве данных используются целые числа. Если требуется хранить структуры, то это повлияет только на скорость заполнения массива, но не время поиска данных. Ключ всегда лучше получать как хеш по данным или уникальное поле данных в структуре.</ol><p>Проведем тестирование скорости заполнения и выборки данных с применением сортированного массива и структуры map, из стандартной библиотеки шаблонов(STL). Для проведения тестирования была написана программа в Visual Studio на языке C++. Проведем три измерения при разных конфигурациях алгоритма и приложения.</p><p>Конфигурации:</p><ol><li><ul><li>iN = 100000 - количество элементов в массиве<li>Debug<li>Не резервируем память вектора зарание</ul><li><ul><li>iN = 10000000 - количество элементов в массиве<li>Release<li>Не резервируем память вектора зарание</ul><li><ul><li>iN = 10000000 - количество элементов в массиве<li>Release<li>Зарезервируем память вектора зарание</ul></ol><p>В данной программе данные заполняются по порядку как в массив, так и в map. Затем, чтобы получить влияние времени сортировки на процесс заполнения данных вектора, данные сортируются в противоположном порядке. Эта операция не нужна для структуры map, поэтому затраты времени на сортировку будут ухудшать временные показатели работы с вектором.</p><p>Программа:</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Скопировано успешно!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;map&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;conio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;conio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;windows.h&gt;</span><span class="cp">
</span>
<span class="cp">#pragma comment( lib, "Winmm.lib" )
</span>
<span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span> <span class="o">&gt;</span>        <span class="n">td_Pair</span><span class="p">;</span>    <span class="c1">// key / value</span>
<span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">td_Pair</span>  <span class="o">&gt;</span>        <span class="n">td_Vector</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span> <span class="o">&gt;</span>        <span class="n">td_Map</span><span class="p">;</span>


<span class="k">struct</span> <span class="nc">st_FindValueStruct</span>
<span class="p">{</span>
    <span class="kt">bool</span>    <span class="k">operator</span><span class="p">()(</span> <span class="k">const</span> <span class="n">td_Pair</span><span class="o">&amp;</span> <span class="n">stLhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">td_Pair</span><span class="o">&amp;</span> <span class="n">stRhs</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">stLhs</span><span class="p">.</span><span class="n">first</span> <span class="o">&gt;</span> <span class="n">stRhs</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">bool</span>    <span class="k">operator</span><span class="p">()(</span> <span class="kt">int</span> <span class="n">iKey</span><span class="p">,</span> <span class="k">const</span> <span class="n">td_Pair</span><span class="o">&amp;</span> <span class="n">stRhs</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">iKey</span> <span class="o">&gt;</span> <span class="n">stRhs</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">bool</span>    <span class="k">operator</span><span class="p">()</span> <span class="p">(</span> <span class="k">const</span> <span class="n">td_Pair</span><span class="o">&amp;</span> <span class="n">stLhs</span><span class="p">,</span> <span class="kt">int</span> <span class="n">iKey</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">stLhs</span><span class="p">.</span><span class="n">first</span> <span class="o">&gt;</span> <span class="n">iKey</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">bool</span> <span class="n">PairSortPred</span><span class="p">(</span> <span class="n">td_Pair</span><span class="o">&amp;</span> <span class="n">stLhs</span><span class="p">,</span> <span class="n">td_Pair</span><span class="o">&amp;</span> <span class="n">stRhs</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">stLhs</span><span class="p">.</span><span class="n">first</span> <span class="o">&gt;</span> <span class="n">stRhs</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
<span class="p">}</span>



<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">td_Vector</span>    <span class="n">vl_arrItems</span><span class="p">;</span>
    <span class="n">td_Map</span>        <span class="n">vl_mapItems</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">iTimeFirst</span><span class="p">,</span> <span class="n">iTimeLast</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">iN</span> <span class="o">=</span> <span class="mi">10000000</span><span class="p">;</span>

    <span class="n">vl_arrItems</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span> <span class="n">iN</span> <span class="p">);</span>
    
    <span class="c1">// fill vector</span>
    <span class="n">iTimeFirst</span> <span class="o">=</span> <span class="n">timeGetTime</span><span class="p">();</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">iInd</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iInd</span> <span class="o">&lt;</span> <span class="n">iN</span><span class="p">;</span> <span class="o">++</span><span class="n">iInd</span> <span class="p">)</span>
        <span class="n">vl_arrItems</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">td_Pair</span><span class="p">(</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">iInd</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">iInd</span> <span class="p">)</span> <span class="p">);</span>
    <span class="n">iTimeLast</span> <span class="o">=</span> <span class="n">timeGetTime</span><span class="p">();</span>
    <span class="n">printf</span><span class="p">(</span> <span class="s">"vector fill: %d</span><span class="se">\n</span><span class="s"> ms"</span><span class="p">,</span> <span class="n">iTimeLast</span> <span class="o">-</span> <span class="n">iTimeFirst</span> <span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">sort</span><span class="p">(</span> <span class="n">vl_arrItems</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vl_arrItems</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">PairSortPred</span> <span class="p">);</span>
     <span class="n">iTimeLast</span> <span class="o">=</span> <span class="n">timeGetTime</span><span class="p">();</span>
    <span class="n">printf</span><span class="p">(</span> <span class="s">"vector fill + sort: %d</span><span class="se">\n</span><span class="s"> ms"</span><span class="p">,</span> <span class="n">iTimeLast</span> <span class="o">-</span> <span class="n">iTimeFirst</span> <span class="p">);</span>


    <span class="c1">// fill map</span>
    <span class="n">iTimeFirst</span> <span class="o">=</span> <span class="n">timeGetTime</span><span class="p">();</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">iInd</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iInd</span> <span class="o">&lt;</span> <span class="n">iN</span><span class="p">;</span> <span class="o">++</span><span class="n">iInd</span> <span class="p">)</span>
        <span class="n">vl_mapItems</span><span class="p">[</span> <span class="n">iInd</span> <span class="p">]</span> <span class="o">=</span> <span class="n">iInd</span><span class="p">;</span>
    <span class="n">iTimeLast</span> <span class="o">=</span> <span class="n">timeGetTime</span><span class="p">();</span>
    <span class="n">printf</span><span class="p">(</span> <span class="s">"map fill: %d ms</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">iTimeLast</span> <span class="o">-</span> <span class="n">iTimeFirst</span> <span class="p">);</span>


    <span class="kt">int</span> <span class="n">iTemp</span><span class="p">;</span>

    <span class="c1">// find all items into vector</span>
    <span class="n">iTimeFirst</span> <span class="o">=</span> <span class="n">timeGetTime</span><span class="p">();</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">iInd</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iInd</span> <span class="o">&lt;</span> <span class="n">iN</span><span class="p">;</span> <span class="o">++</span><span class="n">iInd</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">td_Vector</span><span class="o">::</span><span class="n">iterator</span> <span class="n">pIter</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">lower_bound</span><span class="p">(</span> <span class="n">vl_arrItems</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vl_arrItems</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">iInd</span><span class="p">,</span> <span class="n">st_FindValueStruct</span><span class="p">()</span> <span class="p">);</span>
        <span class="n">iTemp</span> <span class="o">+=</span> <span class="n">pIter</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">iTimeLast</span> <span class="o">=</span> <span class="n">timeGetTime</span><span class="p">();</span>
    <span class="n">printf</span><span class="p">(</span> <span class="s">"vector find all items: %d ms</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">iTimeLast</span> <span class="o">-</span> <span class="n">iTimeFirst</span> <span class="p">);</span>

    
    <span class="c1">// find all items into map</span>
    <span class="n">iTimeFirst</span> <span class="o">=</span> <span class="n">timeGetTime</span><span class="p">();</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">iInd</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iInd</span> <span class="o">&lt;</span> <span class="n">iN</span><span class="p">;</span> <span class="o">++</span><span class="n">iInd</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">td_Map</span><span class="o">::</span><span class="n">iterator</span> <span class="n">pIter</span> <span class="o">=</span> <span class="n">vl_mapItems</span><span class="p">.</span><span class="n">find</span><span class="p">(</span> <span class="n">iInd</span> <span class="p">);</span>
        <span class="n">iTemp</span> <span class="o">+=</span> <span class="n">pIter</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">iTimeLast</span> <span class="o">=</span> <span class="n">timeGetTime</span><span class="p">();</span>
    <span class="n">printf</span><span class="p">(</span> <span class="s">"map find all items: %d ms</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">iTimeLast</span> <span class="o">-</span> <span class="n">iTimeFirst</span> <span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span> <span class="s">"temp: %d ms</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">iTemp</span> <span class="p">);</span>

    <span class="n">getch</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Результаты:</p><p>Следует помнить, что чем время выполнения каждого действия меньше, тем лучше.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Скопировано успешно!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>1. Debug    /     iN = 100000;     /    vl_arrItems.reserve( iN );     - закоментирован
Vector fill: 94 ms
Vector fill + sort: 3297 ms
Map fill: 1500 ms
Vector find all items: 8922 ms
Map find all items: 609 ms
Map Победил по всем показателям.
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Скопировано успешно!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>2. Release    /    iN = 10000000;     /    vl_arrItems.reserve( iN );     - закоментирован
Vector fill: 281 ms
Vector fill + sort: 1203 ms
Map fill: 16516 ms
Vector find all items: 1203 ms
Map find all items: 2203 ms
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Скопировано успешно!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>3. Release    /    iN = 10000000;     /    vl_arrItems.reserve( iN );     - присутствует
Vector fill: 125 ms
Vector fill + sort: 1031 ms
Map fill: 16563 ms
Vector find all items: 1203 ms
Map find all items: 2359 ms
Vector Победил по всем показателям.
</pre></table></code></div></div><p>Вывод: Для данных, которые один раз создаются, а затем используются следует использовать сортированный массив. Он располагает элементы в памяти последовательно, что делает его наиболее быстрым в работе. Это происходит как за счет алгоритма бинарного поиска, так и за счет того, что работа с блоком данных идет быстрее, чем с данными разрозненными в памяти.</p><h3 id="комментарии"><span class="me-2">Комментарии</span><a href="#комментарии" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p><strong>FiloXSee, 13 окт. 2010, 15:03</strong></p><p>Комментарий 1: «gennadiy.brich: обо хеш мап: почему там map назван hash map? это же не правда»</p><p>Комментарий 2: «тестировать вообще нечего — хеш таблица будет оптимальным выбором, если интересует только скорость»</p></blockquote><blockquote><p><strong>FiloXSee, 13 окт. 2010, 15:05</strong></p><p>hash_map — это контейнер стандартной библиотеки. Сейчас его в STL нет, но это не важно. Контейнер становится хешевым не тогда, когда используется hash_map. Достаточно использовать map но в качестве первичного ключа использовать хеш значение чего либо, полученое каким либо алгоритмом. В статье тестируются не стандартные контейнеры, а способы хранения данных и работы с ними.</p><p>В примере используется хеш значение UInt32. Поэтому использование кантейнера map с первичным ключем типа UInt32 равносильно использованию хеш мепа. Причем в данном расмотрении я убрал из кода вычисление этого хеша от чего то, т.е. в действительности хеш меп будет работать еще дольше, т.к. будет вычислять этот хеш. В коде я оставил только основу, которой достаточно чтобы оценить скорость работы алгоритма.</p><p>И еще читайте внимательно вывод. Если данные создаются один раз, а затем только используются, то ВСЕГДА будет более оптимальным использовать сортированный массив (еще и в статической памяти). Это всегда быстрее по скорости и оптимальнее по памяти (если вы с этим не согласны то вам дорога к книге «Эффективное использование С++» Скота Майерса, или к написанию своих тестов). Хеш таблизу имеет смысл использовать только если идет постоянные добавления и удаление элементов из нее. Тогда сортировать каждый раз становится накладно.</p></blockquote><blockquote><p><strong>FiloXSee, 13 окт. 2010, 17:10</strong></p><p>Комментарий 1: «обо хеш мап: почему там map назван hash map? это же не правда»</p><p>Комментарий 2: «тестировать вообще нечего — хеш таблица будет оптимальным выбором, если интересует только скорость»</p></blockquote><blockquote><blockquote><p><strong>FiloXSee, 13 окт. 2010, 17:10</strong></p><p>hash_map — это контейнер стандартной библиотеки. Сейчас его в STL нет, но это не важно. Контейнер становится хешевым не тогда, когда используется hash_map. Достаточно использовать map но в качестве первичного ключа использовать хеш значение чего либо, полученое каким либо алгоритмом. В статье тестируются не стандартные контейнеры, а способы хранения данных и работы с ними.</p><p>В примере используется хеш значение UInt32. Поэтому использование кантейнера map с первичным ключем типа UInt32 равносильно использованию хеш мепа. Причем в данном расмотрении я убрал из кода вычисление этого хеша от чего то, т.е. в действительности хеш меп будет работать еще дольше, т.к. будет вычислять этот хеш. В коде я оставил только основу, которой достаточно чтобы оценить скорость работы алгоритма.</p><p>И еще читайте внимательно вывод. Если данные создаются один раз, а затем только используются, то ВСЕГДА будет более оптимальным использовать сортированный массив (еще и в статической памяти). Это всегда быстрее по скорости и оптимальнее по памяти (если вы с этим не согласны то вам дорога к книге «Эффективное использование С++» Скота Майерса, или к написанию своих тестов). Хеш таблизу имеет смысл использовать только если идет постоянные добавления и удаление элементов из нее. Тогда сортировать каждый раз становится накладно.</p></blockquote></blockquote></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href='/categories/c/'>C++</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/c/" class="post-tag no-text-decoration" >c++</a> <a href="/tags/%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5/" class="post-tag no-text-decoration" >тестирование</a> <a href="/tags/vector/" class="post-tag no-text-decoration" >vector</a> <a href="/tags/hash-map/" class="post-tag no-text-decoration" >hash map</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Публикация защищена лицензией <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> .</div><div class="share-wrapper"> <span class="share-label text-muted me-1">Поделиться</span> <span class="share-icons"> <a href="https://t.me/share/url?url=http%3A%2F%2Fitw66.ru%2Fblog%2Fc_plus_plus%2F15.html&text=%D0%A2%D0%B5%D1%81%D1%82%20%D0%BD%D0%B0%20%D0%B1%D1%8B%D1%81%D1%82%D1%80%D0%BE%D0%B4%D0%B5%D0%B9%D1%81%D1%82%D0%B2%D0%B8%D0%B5:%20Hash%20Map%20vs%20Vector%0A%20-%20It%20Works!" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram" > <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-bs-toggle="tooltip" data-bs-placement="top" title="Скопировать ссылку" data-title-succeed="Ссылка успешно скопирована!" > </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Недавно обновлено</div><ul class="post-content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/blog/china/2.html">Дух Китая. День второй </a><li class="text-truncate lh-lg"> <a href="/blog/china/4.html">Дух Китая. Пекин. Запретный город </a><li class="text-truncate lh-lg"> <a href="/blog/china/1.html">Дух Китая. Первый день, первые впечатления. </a><li class="text-truncate lh-lg"> <a href="/blog/12.html">5 инструментов работы с текстом которые вы обязаны знать </a><li class="text-truncate lh-lg"> <a href="/blog/c_plus_plus/14.html">Как избавится от vcredist'a </a></ul></div><div id="access-tags"><div class="panel-heading">Популярные теги</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/%D0%BA%D0%BE%D1%81%D0%BC%D0%BE%D1%81/">космос</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D0%B0%D0%BB%D1%8C%D1%82%D0%B5%D1%80%D0%BD%D0%B0%D1%82%D0%B8%D0%B2%D0%BD%D0%B0%D1%8F-%D1%8D%D0%BD%D0%B5%D1%80%D0%B3%D0%B8%D1%8F/">альтернативная энергия</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D1%81%D0%BE%D0%BB%D0%BD%D0%B5%D1%87%D0%BD%D0%B0%D1%8F-%D1%8D%D0%BD%D0%B5%D1%80%D0%B3%D0%B8%D1%8F/">солнечная энергия</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D1%8D%D0%BD%D0%B5%D1%80%D0%B3%D0%B8%D1%8F-%D0%B2%D0%B5%D1%82%D1%80%D0%B0/">энергия ветра</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D0%BA%D0%B8%D1%82%D0%B0%D0%B9/">китай</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D0%B0%D0%BB%D1%8C%D1%82%D0%B5%D1%80%D0%BD%D0%B0%D1%82%D0%B8%D0%B2%D0%BD%D0%B0%D1%8F-%D1%8D%D0%BD%D0%B5%D1%80%D0%B3%D0%B5%D1%82%D0%B8%D0%BA%D0%B0/">альтернативная энергетика</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D0%B2%D0%BE%D0%B4%D0%B0/">вода</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D1%8D%D0%BA%D0%BE%D0%BB%D0%BE%D0%B3%D0%B8%D1%8F/">экология</a> <a class="post-tag btn btn-outline-primary" href="/tags/c/">c++</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D0%B7%D0%B5%D0%BC%D0%BB%D1%8F/">земля</a></div></div></div><div id="toc-wrapper" class="ps-0 pe-4 mb-5"><div class="panel-heading ps-3 pt-2 mb-2">Содержание</div><nav id="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-3 pe-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ms-1" data-toc-skip> Вам также может быть интересно</h3><div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><div class="col"> <a href="/blog/illi_studio_blog/620.html" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1333735200" data-df="DD/MM/YYYY" > 07/04/2012 </em><h4 class="pt-0 my-2" data-toc-skip>Нотация iLLi. C++</h4><div class="text-muted small"><p> В далеком уже 2007 году нам в голову пришла одна идея. В то время мы писали код практически не соблюдаю никаких соглашений. Что естественным образом выливалось в том, что даже мы сами между собой и...</p></div></div></a></div><div class="col"> <a href="/blog/c_sharp/499.html" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1309197600" data-df="DD/MM/YYYY" > 28/06/2011 </em><h4 class="pt-0 my-2" data-toc-skip>Интеграция Native кода в C# проект</h4><div class="text-muted small"><p> Сегодня стала очень популярной платформа .Net Framework и язык C#. На ней пишутся приложения, игры, инструменты. Однако существует много кода написанного на C++, который часто нужно использовать в ...</p></div></div></a></div><div class="col"> <a href="/blog/cpp_cli/500.html" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1309629600" data-df="DD/MM/YYYY" > 03/07/2011 </em><h4 class="pt-0 my-2" data-toc-skip>Как подписать C++/CLI сборку строгим именем</h4><div class="text-muted small"><p> Если у вас в составе проекта есть сборка Managed C++ и вы захотите подписать остальные сборки строгим именем, то вам придется подписать и данную сборку. Visual Studio потребует, чтобы все сборки бы...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/blog/c_plus_plus/13.html" class="btn btn-outline-primary" prompt="Следующая публикация" ><p>Оптимизация кода на С++</p></a> <a href="/blog/space/16.html" class="btn btn-outline-primary" prompt="Предыдущая публикация" ><p>Кольцо луны. Гигантская солнечная электростанция на луне</p></a></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Популярные теги</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/%D0%BA%D0%BE%D1%81%D0%BC%D0%BE%D1%81/">космос</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D0%B0%D0%BB%D1%8C%D1%82%D0%B5%D1%80%D0%BD%D0%B0%D1%82%D0%B8%D0%B2%D0%BD%D0%B0%D1%8F-%D1%8D%D0%BD%D0%B5%D1%80%D0%B3%D0%B8%D1%8F/">альтернативная энергия</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D1%81%D0%BE%D0%BB%D0%BD%D0%B5%D1%87%D0%BD%D0%B0%D1%8F-%D1%8D%D0%BD%D0%B5%D1%80%D0%B3%D0%B8%D1%8F/">солнечная энергия</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D1%8D%D0%BD%D0%B5%D1%80%D0%B3%D0%B8%D1%8F-%D0%B2%D0%B5%D1%82%D1%80%D0%B0/">энергия ветра</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D0%BA%D0%B8%D1%82%D0%B0%D0%B9/">китай</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D0%B0%D0%BB%D1%8C%D1%82%D0%B5%D1%80%D0%BD%D0%B0%D1%82%D0%B8%D0%B2%D0%BD%D0%B0%D1%8F-%D1%8D%D0%BD%D0%B5%D1%80%D0%B3%D0%B5%D1%82%D0%B8%D0%BA%D0%B0/">альтернативная энергетика</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D0%B2%D0%BE%D0%B4%D0%B0/">вода</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D1%8D%D0%BA%D0%BE%D0%BB%D0%BE%D0%B3%D0%B8%D1%8F/">экология</a> <a class="post-tag btn btn-outline-primary" href="/tags/c/">c++</a> <a class="post-tag btn btn-outline-primary" href="/tags/%D0%B7%D0%B5%D0%BC%D0%BB%D1%8F/">земля</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div></div><footer><div class="container px-lg-4"><div class="d-flex justify-content-center align-items-center text-muted mx-md-3"><p>Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme</p><p>© 2023 <a href=""></a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Публикации на сайте защищены лицензией Creative Commons Attribution 4.0 International (CC BY 4.0), если в тексте публикации не указано иное." >Некоторые права защищены.</span></p></div></div></footer><div id="mask"></div><button id="back-to-top" aria-label="back-to-top" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">Доступна новая версия контента.</p><button type="button" class="btn btn-primary" aria-label="Update"> Обновлять </button></div></div><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.0/dist/jquery.min.js,npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.7/dayjs.min.js,npm/dayjs@1.11.7/locale/ru.min.js,npm/dayjs@1.11.7/plugin/relativeTime.min.js,npm/dayjs@1.11.7/plugin/localizedFormat.min.js,npm/tocbot@4.21.0/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-16734363-3"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-16734363-3'); }); </script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="px-1 px-sm-2 px-lg-4 px-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="//mc.yandex.ru/metrika/watch.js" type="text/javascript"></script><div style="display:none;"><script type="text/javascript"> try { var yaCounter1534027 = new Ya.Metrika(1534027); } catch(e){} </script></div><noscript><div style="position:absolute"><img src="//mc.yandex.ru/watch/1534027" alt="" /></div></noscript>
